# 標準檢視表 (Standard View)與索引檢視表(Indexed View)
在 SQL Server 中，**標準檢視表 (Standard View)** 和 **索引檢視表 (Indexed View)** 是兩種不同類型的檢視表，它們在功能、用途和實現方式上有顯著差異。以下是它們的主要差別，用繁體中文詳細說明：

---

### 1. **定義與基本概念**
- **標準檢視表**：
  - 標準檢視表是一個虛擬的資料表，基於一個或多個基礎資料表的 `SELECT` 查詢。
  - 它僅儲存查詢的定義（元資料），不儲存實際資料。
  - 每次查詢檢視表時，SQL Server 會動態執行檢視表的 `SELECT` 查詢，從基礎資料表中提取最新資料。
  - 用途：簡化複雜查詢、提供資料的邏輯視圖、限制資料存取。

- **索引檢視表**：
  - 索引檢視表是一個實體化的檢視表，透過建立唯一叢集索引 (Unique Clustered Index) 將檢視表的查詢結果儲存在磁碟上。
  - 它實際儲存資料，類似於一個實體資料表，並會隨著基礎資料表的變更（插入、更新、刪除）自動更新。
  - 用途：提升特定查詢的效能，特別是涉及聚合或大量資料的場景。

---

### 2. **資料儲存**
- **標準檢視表**：
  - 不儲存資料，僅儲存查詢定義。
  - 查詢時，資料從基礎資料表即時檢索，類似於執行一個儲存的 SQL 查詢。
  - 因此，它不佔用額外的儲存空間（除了元資料）。

- **索引檢視表**：
  - 儲存實際資料，與叢集索引的結構一起保存在資料庫中。
  - 因為資料被實體化，會佔用額外的磁碟空間，類似於一個資料表。
  - 當基礎資料表變更時，SQL Server 會自動更新索引檢視表的資料。

---

### 3. **索引支援**
- **標準檢視表**：
  - 無法直接在標準檢視表上建立索引。
  - 若需要索引，必須在基礎資料表上建立，並依賴查詢最佳化器來利用這些索引。
  - 效能取決於基礎資料表的索引和查詢設計。

- **索引檢視表**：
  - 必須建立一個唯一叢集索引，這會將檢視表實體化。
  - 可以進一步在索引檢視表上建立非叢集索引 (Non-Clustered Index)，以提升查詢效能。
  - SQL Server 的查詢最佳化器可能自動使用索引檢視表來加速查詢，即使查詢未直接引用該檢視表（僅限 Enterprise 版本）。

---

### 4. **限制與要求**
- **標準檢視表**：
  - 限制較少，支援靈活的查詢設計。
  - 可以包含子查詢、外連線 (Outer Join)、非確定性函數（如 `GETDATE()`）等。
  - 不需要 `SCHEMABINDING`，但可以選擇使用。
  - 支援所有 SQL Server 版本和版本類型。

- **索引檢視表**：
  - 有嚴格的限制，以確保資料一致性和維護效率：
    - 必須使用 `WITH SCHEMABINDING`，綁定檢視表與基礎資料表的結構，防止結構變更（如刪除欄位）。
    - 不能包含子查詢、外連線、自我連線、非確定性函數（如 `GETDATE()`）等。
    - 如果包含 `GROUP BY` 或聚合函數，必須在 `SELECT` 清單中加入 `COUNT_BIG(*)`。
    - 基礎資料表必須使用兩部分命名法（例如 `dbo.Sales`）。
  - 僅在 SQL Server 的 **Enterprise Edition** 或 **Developer Edition** 中完全支援（Standard Edition 僅支援部分功能，且查詢不會自動使用索引檢視表）。

---

### 5. **效能影響**
- **標準檢視表**：
  - 效能取決於基礎資料表的索引和查詢的複雜度。
  - 因為資料是即時檢索的，對於複雜查詢或大資料量，可能需要更多計算資源。
  - 適合用於簡化查詢邏輯或限制資料存取，但不直接提升效能。

- **索引檢視表**：
  - 透過實體化資料，顯著提升特定查詢的效能，特別是涉及聚合（如 `SUM`、`COUNT`）或經常重複的查詢。
  - 查詢執行時直接從儲存的資料中檢索，減少計算開銷。
  - 缺點：基礎資料表變更時，索引檢視表的維護會增加額外的效能開銷（例如更新索引資料），可能影響寫入操作（插入、更新、刪除）的速度。

---

### 6. **使用場景**
- **標準檢視表**：
  - 簡化複雜的查詢邏輯，例如將多個資料表聯結成一個邏輯視圖。
  - 提供資料的安全存取，限制使用者只能看到特定欄位或資料列。
  - 支援靈活的查詢設計，適用於報表、資料分析或應用程式前端。

- **索引檢視表**：
  - 最佳化高頻率、計算密集型的查詢，例如商業報表的聚合資料（銷售總額、庫存統計）。
  - 適用於資料倉儲或 OLAP 場景，需快速存取預計算的結果。
  - 當資料變更頻率較低但查詢頻率高時，效果最佳。

---

### 7. **維護與管理**
- **標準檢視表**：
  - 維護簡單，僅需更新檢視表的定義（若查詢邏輯改變）。
  - 不影響基礎資料表的效能或結構。
  - 若基礎資料表結構變更，檢視表可能需要調整，但影響較小。

- **索引檢視表**：
  - 維護成本較高，因為索引檢視表的資料需與基礎資料表保持同步。
  - 基礎資料表的任何變更（插入、更新、刪除）都會觸發索引檢視表的更新，增加寫入操作的開銷。
  - 基礎資料表結構變更（如新增或刪除欄位）可能因 `SCHEMABINDING` 而受限，需先移除索引檢視表。

---

### 比較表
| 特性                | 標準檢視表                          | 索引檢視表                          |
|---------------------|-------------------------------------|-------------------------------------|
| **資料儲存**        | 不儲存資料，僅儲存查詢定義         | 儲存實體化資料，佔用磁碟空間       |
| **索引支援**        | 無法直接建立索引                   | 必須有唯一叢集索引，可加非叢集索引 |
| **效能**            | 取決於基礎資料表，無直接提升       | 查詢效能高，但寫入操作有開銷       |
| **限制**            | 限制少，查詢設計靈活               | 限制多（如 SCHEMABINDING、COUNT_BIG）|
| **使用場景**        | 簡化查詢、限制存取                 | 優化高頻查詢、聚合報表             |
| **支援版本**        | 所有版本                           | 主要為 Enterprise/Developer 版本    |

---

### 總結
- **標準檢視表** 適合需要靈活查詢邏輯或資料存取控制的場景，簡單易用但不直接提升效能。
- **索引檢視表** 適合需要高效能查詢的場景，特別是聚合或重複查詢，但有嚴格限制且維護成本較高，適用於特定業務需求（如報表或資料倉儲）。
